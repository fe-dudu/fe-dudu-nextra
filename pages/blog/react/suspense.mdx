# Suspense
`children`ì˜ ë Œë”ë§ì´ ì™„ë£Œë  ë•Œê¹Œì§€ `fallback`ì„ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Props
- **children:** ë Œë”ë§í•˜ê³ ì í•˜ëŠ” UIì´ë©°, `children`ì˜ ë Œë”ë§ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´ `fallback`ìœ¼ë¡œ ë Œë”ë§ì´ ì „í™˜ë©ë‹ˆë‹¤.
- **fallback:** ë Œë”ë§ì´ ì™„ë£Œë˜ì§€ ì•Šì€ ê²½ìš° ì‹¤ì œ UI ëŒ€ì‹  ë Œë”ë§í•  ëŒ€ì²´ UIì…ë‹ˆë‹¤.
```js
<Suspense fallback={<Loading />}>
  <Component />
</Suspense>
```

## ì£¼ì˜ì‚¬í•­
- **ì´ˆê¸° ë Œë”ë§ ì „ ìƒíƒœ ë³´ì¡´ ì—†ìŒ:** ì²˜ìŒ ë§ˆìš´íŠ¸ë˜ê¸° ì „ suspended ë˜ê³  ë‹¤ì‹œ ë Œë”ë§ì„ ì‹œë„í•˜ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë Œë”ë§í•©ë‹ˆë‹¤. (ì¤‘ë‹¨ ì‹œì ì„ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.)

- **Suspenseì—ì„œì˜ Fallback ë™ì‘:** `children`ì´ ë‹¤ì‹œ suspended ìƒíƒœê°€ ë˜ë©´ `fallback`ì´ ë‹¤ì‹œ í‘œì‹œë©ë‹ˆë‹¤. `startTransition`ì´ë‚˜ `useDeferredValue`ì— ì˜í•œ ê²ƒì´ë¼ë©´ `fallback`ì´ ë‹¤ì‹œ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ìˆ¨ê²¨ì§„ ì½˜í…ì¸ ì˜ layoutEffect ê´€ë¦¬:** `children`ì´ ë‹¤ì‹œ suspended ìƒíƒœê°€ ë˜ë©´ `layoutEffect`ì˜ `clean up`ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.

- **Reactì˜ ìµœì í™” ê¸°ëŠ¥:** `Suspense`ì™€ í†µí•©ëœ Streaming Server Renderingê³¼ Selective Hydrationê³¼ ê°™ì€ ì—¬ëŸ¬ ìµœì í™” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì£¼ìš” ì‚¬ìš©ë²•

### `useSuspenseQuery`
```js
import { Suspense } from 'react';
import { useSuspenseQuery } from '@tanstack/react-query';

function SearchList() {
  const { data } = useSuspenseQuery({
    queryKey: ['searchItems'],
    queryFn: () => API.searchItems(),
  });

  return (
    <>
      {data.map((item) => (
        <SearchItem key={item.id} item={item} />
      ))}
    </>
  );
}

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <SearchList />
    </Suspense>
  );
}
```
- `useSuspenseQuery`ëŠ” `Suspense`ë¥¼ ì˜ ì§€ì›í•©ë‹ˆë‹¤.
- ë°ì´í„° í˜ì¹­ì˜ ì„±ê³µ ìƒíƒœì—ë§Œ ì§‘ì¤‘í•©ë‹ˆë‹¤.
- ë¡œë”© ìƒíƒœëŠ” `Suspense`ì—ì„œ ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
- ì—ëŸ¬ ì²˜ë¦¬ì˜ ê²½ìš° `Errorboundary`ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### `React.use`
```js
import React, { Suspense } from 'react';

const fetchData = async () => {
  const response = await fetch('https://jsonplaceholder.typicode.com/posts');
  if (!response.ok) {
    throw new Error('Failed to fetch data');
  }
  return response.json();
};

const DataList = () => {
  const data = React.use(fetchData());

  return (
    <ul>
      {data.map((post: { id: number; title: string }) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
};

const App = () => {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <DataList />
    </Suspense>
  );
};

export default App;
```
- ë¡œë”© ìƒíƒœëŠ” `Suspense`ì—ì„œ ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
- ì—ëŸ¬ ì²˜ë¦¬ì˜ ê²½ìš° `Errorboundary`ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `React.lazy`
```js
import React, { Suspense } from 'react';

const LazyComponent = React.lazy(() => import('./LazyComponent'));

const App = () => {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <LazyComponent />
    </Suspense>
  );
};

export default App;
```
- ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” ë™ì•ˆ `fallback`ì„ í‘œì‹œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

### `useDeferredValue`
```js
export default function App() {
  const [query, setQuery] = useState('');
  const deferredQuery = useDeferredValue(query);
  return (
    <>
      <label>
        Search albums:
        <input value={query} onChange={e => setQuery(e.target.value)} />
      </label>
      <Suspense fallback={<h2>Loading...</h2>}>
        <div style={{ opacity: query !== deferredQuery ? 0.5 : 1 }}>
          <SearchResults query={deferredQuery} />
        </div>
      </Suspense>
    </>
  );
}
```
- `useDeferredValue`ë¥¼ ì‚¬ìš©í•˜ë©´ fallbackì„ ë³´ì—¬ì£¼ì§€ ì•Šê³  ì´ì „ ê²°ê³¼ë¥¼ ê³„ì† ë³´ì—¬ì¤ë‹ˆë‹¤.
- ì´ì „ ìƒíƒœì™€ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `query !== deferredQuery ? 0.5 : 1`

### `useTransition` & `Router`
```js {16, 19-21, 31-36, 40}
import { Suspense, useState, useTransition } from 'react';
import IndexPage from './IndexPage.js';
import ArtistPage from './ArtistPage.js';
import Layout from './Layout.js';

export default function App() {
  return (
    <Suspense fallback={<BigSpinner />}>
      <Router />
    </Suspense>
  );
}

function Router() {
  const [page, setPage] = useState('/');
  const [isPending, startTransition] = useTransition();

  function navigate(url) {
    startTransition(() => {
      setPage(url);
    });
  }

  let content;
  if (page === '/') {
    content = (
      <IndexPage navigate={navigate} />
    );
  } else if (page === '/the-beatles') {
    content = (
      <ArtistPage // React.useë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
        artist={{
          id: 'the-beatles',
          name: 'The Beatles',
        }}
      />
    );
  }
  return (
    <Layout isPending={isPending}>
      {content}
    </Layout>
  );
}

function BigSpinner() {
  return <h2>ğŸŒ€ Loading...</h2>;
}
```
- `startTransition`ë¥¼ ì‚¬ìš©í•˜ë©´ fallbackì„ ë³´ì—¬ì£¼ì§€ ì•Šê³  ì´ì „ ê²°ê³¼ë¥¼ ê³„ì† ë³´ì—¬ì¤ë‹ˆë‹¤.
- `isPending`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§„í–‰ ì¤‘ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- `useTransition`ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ `fallback`ì´ ë…¸ì¶œë©ë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ
[React Docs | Suspense](https://react.dev/reference/react/Suspense)